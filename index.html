<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Faucet DApp</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.9.0/dist/web3.min.js"></script>
</head>
<body>
  <h1>ü™ô Faucet DApp</h1>
  <p id="status">Wallet not connected</p>
  <button onclick="connectWallet()">Connect Wallet</button>
  <button onclick="claimTokens()">Claim Tokens</button>
  <p id="balance">Your Token Balance: -</p>

  <script>
    let web3;
    let faucetContract;
    let tokenContract;
    let userAccount;

    const faucetAddress = "0xE85c7C0530D4A491a418a63d91f3De417911F135";

    const faucetABI = [/* your fixed faucet ABI here */];

    const erc20ABI = [
      {
        "constant": true,
        "inputs": [{"name": "_owner", "type": "address"}],
        "name": "balanceOf",
        "outputs": [{"name": "balance", "type": "uint256"}],
        "type": "function"
      },
      {
        "constant": true,
        "inputs": [],
        "name": "decimals",
        "outputs": [{"name": "", "type": "uint8"}],
        "type": "function"
      }
    ];

    async function connectWallet() {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        await window.ethereum.request({ method: 'eth_requestAccounts' });
        const accounts = await web3.eth.getAccounts();
        userAccount = accounts[0];

        faucetContract = new web3.eth.Contract(faucetABI, faucetAddress);

        // Fetch token address from faucet contract
        const tokenAddress = await faucetContract.methods.token().call();
        tokenContract = new web3.eth.Contract(erc20ABI, tokenAddress);

        document.getElementById('status').innerText = `‚úÖ Wallet connected: ${userAccount}`;
        getBalance();
      } else {
        alert("Please install MetaMask!");
      }
    }

    async function getBalance() {
      const rawBalance = await tokenContract.methods.balanceOf(userAccount).call();
      const decimals = await tokenContract.methods.decimals().call();
      const readableBalance = rawBalance / (10 ** decimals);
      document.getElementById('balance').innerText = `Your Token Balance: ${readableBalance}`;
    }

    async function claimTokens() {
      try {
        await faucetContract.methods.claim().send({ from: userAccount });
        alert("‚úÖ Tokens claimed successfully!");
        getBalance(); // Refresh balance
      } catch (err) {
        alert("‚ùå Error: " + err.message);
      }
    }
  </script>
</body>
</html>
